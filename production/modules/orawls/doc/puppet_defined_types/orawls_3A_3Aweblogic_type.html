<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  Defined Type: orawls::weblogic_type
  
    &mdash; Documentation by YARD 0.9.8
  
</title>

  <link rel="stylesheet" href="../css/style.css" type="text/css" charset="utf-8" />

  <link rel="stylesheet" href="../css/common.css" type="text/css" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  pathId = "puppet_defined_types::orawls::weblogic_type";
  relpath = '../';
</script>


  <script type="text/javascript" charset="utf-8" src="../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="../puppet_defined_type_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="../_index.html">Index (o)</a> &raquo;
    <span class='title'><span class='object_link'>Defined Types</span></span>
     &raquo; 
    <span class="title">orawls::weblogic_type</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="puppet_class_list_link"
        href="../puppet_class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><h1>Defined Type: orawls::weblogic_type</h1>
<div class="box_info">
  <dl>
    <dt>Defined in:</dt>
    <dd>
      manifests/weblogic_type.pp
    </dd>
  </dl>
</div>
<h2>Overview</h2>
<div class="docstring">
  <div class="discussion">
    
<p>weblogic installation define</p>

<p>Will allow to install multiple WebLogic Middleware homes on a VM</p>

  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
        <p class="example_title"><div class='inline'>
<p>Declaring the define</p>
</div></p>
      
      <pre class="example code"><code>orawls::weblogic_type{&#39;12212&#39;:
  version                   =&gt; 12212,
  filename                  =&gt; &#39;fmw_12.2.1.2.0_wls.jar&#39;,
  jdk_home_dir              =&gt; &#39;/usr/java/latest&#39;,
  oracle_base_home_dir      =&gt; &quot;/opt/oracle&quot;,
  middleware_home_dir       =&gt; &quot;/opt/oracle/middleware12c&quot;,
  weblogic_home_dir         =&gt; &quot;/opt/oracle/middleware12c/wlserver&quot;,
  download_dir              =&gt; &quot;/var/tmp/install&quot;,
  puppet_download_mnt_point =&gt; &quot;/software&quot;,
  log_output                =&gt; true,
  remote_file               =&gt; false
}</code></pre>
    
  </div>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>version</span>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>lookup(&#39;orawls::default_version&#39;)</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>Weblogic version like 1036, 1111, 1213 or 12212</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>filename</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>undef</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>the weblogic jar file like wls1036_generic.jar or fmw_12.2.1.2.0_wls.jar</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>oracle_base_home_dir</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>undef</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>base directory of the oracle installation, it will contain the default
Oracle inventory and the middleware home</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>middleware_home_dir</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>undef</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>directory of the Oracle software inside the oracle base directory</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>weblogic_home_dir</span>
      
      
        <span class='type'>(<tt>Optional[String]</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>undef</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>directory of the WebLogic software inside the middleware directory</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>wls_domains_dir</span>
      
      
        <span class='type'>(<tt>Optional[String]</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>undef</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>root directory for all the WebLogic domains</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>wls_apps_dir</span>
      
      
        <span class='type'>(<tt>Optional[String]</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>undef</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>root directory for all the domain apps</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>fmw_infra</span>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>false</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>should install the WebLogic 12c infrastructure edition, you cannot use the
normal wls install jar</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>jdk_home_dir</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>undef</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>full path to the java home directory like /usr/java/default</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>os_user</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>lookup(&#39;orawls::user&#39;)</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>the user name with oracle as default</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>os_group</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>lookup(&#39;orawls::group&#39;)</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>the group name with dba as default</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>download_dir</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>lookup(&#39;orawls::download_dir&#39;)</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>the directory for temporary created by this class</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>puppet_download_mnt_point</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>lookup(&#39;orawls::module_mountpoint&#39;)</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>the location of the filename like puppet:///modules/orawls/ or /software</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>remote_file</span>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>true</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>to control if the filename is already accessiable on the VM</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>java_parameters</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>&#39;&#39;</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>provide additional parameters to the WebLogic Installation</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>log_output</span>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>false</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>show all the output of the the exec actions</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>temp_dir</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>lookup(&#39;orawls::tmp_dir&#39;)</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>override the default temp directory /tmp</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>validation</span>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>true</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>ignore validation all the errrors</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>force</span>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>false</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>force the installation of WebLogic</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>orainstpath_dir</span>
      
      
        <span class='type'>(<tt>Optional[String]</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>lookup(&#39;orawls::orainst_dir&#39;)</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>the location of orainst.loc, default it will the default directory for
Linux or Solaris</p>
</div>
      
    </li>
  
</ul>


</div><div class="method_details_list">
  <table class="source_code">
    <tr>
      <td>
        <pre class="lines">


41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252</pre>
      </td>
      <td>
        <pre class="code"><span class="info file"># File 'manifests/weblogic_type.pp', line 41</span>

define orawls::weblogic_type (
  Integer $version                    = lookup(&#39;orawls::default_version&#39;),
  String $filename                    = undef, # wls1036_generic.jar|wls1211_generic.jar|wls_121200.jar|wls_121300.jar|oepe-wls-indigo-installer-11.1.1.8.0.201110211138-10.3.6-linux32.bin
  String $oracle_base_home_dir        = undef, # /opt/oracle
  String $middleware_home_dir         = undef, # /opt/oracle/middleware11gR1
  Optional[String] $weblogic_home_dir = undef, # /opt/oracle/middleware11gR1/wlserver
  Optional[String] $wls_domains_dir   = undef, # /opt/oracle/wlsdomains/domains
  Optional[String] $wls_apps_dir      = undef, # /opt/oracle/wlsdomains/applications
  Boolean $fmw_infra                  = false, # true|false 1212/1213/1221 option -&gt; plain weblogic or fmw infra
  String $jdk_home_dir                = undef, # /usr/java/jdk1.7.0_45
  String $os_user                     = lookup(&#39;orawls::user&#39;), # oracle
  String $os_group                    = lookup(&#39;orawls::group&#39;), # dba
  String $download_dir                = lookup(&#39;orawls::download_dir&#39;),
  String $puppet_download_mnt_point   = lookup(&#39;orawls::module_mountpoint&#39;), # puppet:///modules/orawls/ | /mnt | /vagrant
  Boolean $remote_file                = true,  # true|false
  String $java_parameters             = &#39;&#39;,    # &#39;-Dspace.detection=false&#39;
  Boolean $log_output                 = false, # true|false
  Boolean $validation                 = true,  # true|false
  Boolean $force                      = false, # true|false
  String $temp_dir                    = lookup(&#39;orawls::tmp_dir&#39;),# /tmp temporary directory for files extractions
  Optional[String] $orainstpath_dir   = lookup(&#39;orawls::orainst_dir&#39;),
)
{

  if ( $wls_domains_dir != undef) {
    # make sure you don&#39;t create the middleware home, else root will be owner
    if ($wls_domains_dir == &quot;${middleware_home_dir}/user_projects/domains&quot;) {
        $domains_dir =  undef
    } else {
        $domains_dir =  $wls_domains_dir
    }
  } else {
    $domains_dir =  undef
  }
  if ( $wls_apps_dir != undef) {
    # make sure you don&#39;t create the middleware home, else root will be owner
    if ($wls_apps_dir == &quot;${middleware_home_dir}/user_projects/applications&quot;) {
        $apps_dir =  undef
    } else {
        $apps_dir =  $wls_apps_dir
    }
  } else {
    $apps_dir =  undef
  }

  if ($version == 1036 or $version == 1111 or $version == 1211) {
    $silent_template = &#39;orawls/weblogic_silent_install.xml.epp&#39;
    $install_type = &#39;dummy&#39;
  } elsif ( $version == 1212 or $version == 1213 or $version &gt;= 1221 ) {

    #The oracle home location. This can be an existing Oracle Home or a new Oracle Home
    if ( $fmw_infra == true ) {
      $install_type = &#39;Fusion Middleware Infrastructure&#39;
    } else {
      $install_type = &#39;WebLogic Server&#39;
    }
    if $version &gt;= 1221 {
      $new_version = 1221
    } else {
      $new_version = $version
    }
    $silent_template = &quot;orawls/weblogic_silent_install_${new_version}.rsp.epp&quot;

  } else  {
    fail(&#39;unknown weblogic version parameter&#39;)
  }

  $exec_path         = &quot;${jdk_home_dir}/bin:${lookup(&#39;orawls::exec_path&#39;)}&quot;
  $ora_inventory_dir = &quot;${oracle_base_home_dir}/oraInventory&quot;

  Exec {
    logoutput =&gt; $log_output,
  }

  $oraInstPath = lookup(&#39;orawls::orainst_dir&#39;)
  $java_statement = &quot;${lookup(&#39;orawls::java&#39;)} ${java_parameters}&quot;
  $file_ext = regsubst($filename, &#39;.*(\.jar)$&#39;, &#39;\1&#39;)

  if $file_ext == &#39;.jar&#39; {
    $jar_file = true
  } else {
    $jar_file = false
  }

  if $jar_file {
    $cmd_prefix = &quot;${java_statement} -Xmx1024m -Djava.io.tmpdir=${temp_dir} -jar &quot;
  } else {
    $cmd_prefix = &#39;&#39;
  }

  if $remote_file == true {
    $weblogic_jar_location = &quot;${download_dir}/${filename}&quot;
  } else {
    $weblogic_jar_location = &quot;${puppet_download_mnt_point}/${filename}&quot;
  }

  if $validation == false {
    $validation_string = &#39;-novalidation&#39;
  } else {
    $validation_string = &#39;&#39;
  }

  if $force == true {
    $force_string = &#39;-force&#39;
  } else {
    $force_string = &#39;&#39;
  }

  orawls::utils::orainst { &quot;weblogic orainst ${title}&quot;:
    ora_inventory_dir =&gt; $ora_inventory_dir,
    os_group          =&gt; $os_group,
  }

  wls_directory_structure{&quot;weblogic structure ${title}&quot;:
    ensure            =&gt; present,
    oracle_base_dir   =&gt; $oracle_base_home_dir,
    ora_inventory_dir =&gt; $ora_inventory_dir,
    download_dir      =&gt; $download_dir,
    wls_domains_dir   =&gt; $domains_dir,
    wls_apps_dir      =&gt; $apps_dir,
    os_user           =&gt; $os_user,
    os_group          =&gt; $os_group,
    require           =&gt; Orawls::Utils::Orainst[&quot;weblogic orainst ${title}&quot;],
  }

  # for performance reasons, download and install or just install it
  if $remote_file == true {
    # put weblogic generic jar
    if !defined(File[&quot;${download_dir}/${filename}&quot;]) {
      file { &quot;${download_dir}/${filename}&quot;:
        ensure  =&gt; file,
        source  =&gt; &quot;${puppet_download_mnt_point}/${filename}&quot;,
        replace =&gt; false,
        backup  =&gt; false,
        mode    =&gt; lookup(&#39;orawls::permissions&#39;),
        owner   =&gt; $os_user,
        group   =&gt; $os_group,
        before  =&gt; Exec[&quot;install weblogic ${title}&quot;],
        require =&gt; Wls_directory_structure[&quot;weblogic structure ${title}&quot;],
      }
    }
    # we need to make proper dependency even when File[&quot;${download_dir}/${filename}&quot;] is already defined
    Wls_directory_structure[&quot;weblogic structure ${title}&quot;] -&gt; File[&quot;${download_dir}/${filename}&quot;] -&gt; Exec[&quot;install weblogic ${title}&quot;]
  }

  # de xml used by the wls installer
  file { &quot;${download_dir}/weblogic_silent_install_${title}.xml&quot;:
    ensure  =&gt; present,
    content =&gt; epp($silent_template, {
                    &#39;middleware_home_dir&#39; =&gt; $middleware_home_dir,
                    &#39;weblogic_home_dir&#39;   =&gt; $weblogic_home_dir,
                    &#39;install_type&#39;        =&gt; $install_type }),
    replace =&gt; true,
    mode    =&gt; lookup(&#39;orawls::permissions&#39;),
    owner   =&gt; $os_user,
    group   =&gt; $os_group,
    backup  =&gt; false,
    require =&gt; Wls_directory_structure[&quot;weblogic structure ${title}&quot;],
  }

  # if weblogic home dir is specified then check that for creates
  if ( $weblogic_home_dir != undef ) {
    $created_dir = $weblogic_home_dir
  } else {
    $created_dir = $middleware_home_dir
  }

  if ($version == 1212 or $version == 1213 or $version &gt;= 1221 ) {

    $command = &quot;-silent -responseFile ${download_dir}/weblogic_silent_install_${title}.xml ${validation_string} ${force_string} &quot;

    # notify { &quot;install weblogic ${version}: ${exec_path}&quot;: }
    exec { &quot;install weblogic ${title}&quot;:
      command     =&gt; &quot;${cmd_prefix}${weblogic_jar_location} ${command} -invPtrLoc ${oraInstPath}/oraInst.loc -ignoreSysPrereqs&quot;,
      environment =&gt; [&#39;JAVA_VENDOR=Sun&#39;, &quot;JAVA_HOME=${jdk_home_dir}&quot;],
      timeout     =&gt; 0,
      creates     =&gt; $created_dir,
      path        =&gt; $exec_path,
      user        =&gt; $os_user,
      group       =&gt; $os_group,
      require     =&gt; [Wls_directory_structure[&quot;weblogic structure ${title}&quot;],
                      Orawls::Utils::Orainst[&quot;weblogic orainst ${title}&quot;],
                      File[&quot;${download_dir}/weblogic_silent_install_${title}.xml&quot;]],
    }
    # OPatch native lib fix for 64 solaris
    case $facts[&#39;kernel&#39;] {
      &#39;SunOS&#39;: {
        exec { &quot;add -d64 oraparam.ini oracle_common ${title}&quot;:
          command =&gt; &quot;sed -e&#39;s/JRE_MEMORY_OPTIONS=/JRE_MEMORY_OPTIONS=\&quot;-d64\&quot;/g&#39; ${middleware_home_dir}/oui/oraparam.ini &gt; ${temp_dir}/wls.tmp &amp;&amp; mv ${temp_dir}/wls.tmp ${middleware_home_dir}/oui/oraparam.ini&quot;,
          unless  =&gt; &quot;grep &#39;JRE_MEMORY_OPTIONS=\&quot;-d64\&quot;&#39; ${middleware_home_dir}/oui/oraparam.ini&quot;,
          require =&gt; Exec[&quot;install weblogic ${title}&quot;],
          path    =&gt; $exec_path,
          user    =&gt; $os_user,
          group   =&gt; $os_group,
        }
      }
    }

  } else {
    exec {&quot;install weblogic ${title}&quot;:
      command     =&gt; &quot;${cmd_prefix}${weblogic_jar_location} -Djava.io.tmpdir=${temp_dir} -Duser.country=US -Duser.language=en -mode=silent ${validation_string} ${force_string} -log=${temp_dir}/wls_${title}.out -log_priority=info -silent_xml=${download_dir}/weblogic_silent_install_${title}.xml&quot;,
      environment =&gt; [&#39;JAVA_VENDOR=Sun&#39;,&quot;JAVA_HOME=${jdk_home_dir}&quot;],
      creates     =&gt; $created_dir,
      timeout     =&gt; 0,
      path        =&gt; $exec_path,
      user        =&gt; $os_user,
      group       =&gt; $os_group,
      require     =&gt; [Wls_directory_structure[&quot;weblogic structure ${title}&quot;],
                      File[&quot;${download_dir}/weblogic_silent_install_${title}.xml&quot;]],
    }
  }
}</pre>
      </td>
    </tr>
  </table>
</div>
</div>

      <div id="footer">
  Generated on Sun Mar  5 20:34:33 2017 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.9.8 (ruby-2.3.1).
</div>

    </div>
  </body>
</html>